{% extends "two_factor/_base_focus.html" %}

{% load i18n static two_factor %}

{% block extrahead %}

<script type="text/javascript" src="{% static 'js/show_password.js' %}"></script>
<script>
function isIE() {
  return (window.navigator.userAgent.indexOf('MSIE ') > 0 || window.navigator.userAgent.indexOf('Trident/') > 0);
}

if (isIE()) alert("{% trans "This site does not support Internet Explorer. Please use another browser." %}");

$(document).ready(function (){
    initToggleShowPassword($('#id_auth-password'), $('#id_toggle-password'));
});

</script>
{% endblock %}

{% block content %}
  <form action="" method="post">
    {% csrf_token %}

      <div class="card">
        <div class="card-header">{% trans "Login" %}</div>
        <div class="card-body">
          <div class="row">
            {% if messages %}
              {% for message in messages %}
                {% if message.level == DEFAULT_MESSAGE_LEVELS.SUCCESS %}
                <div class="col-sm-12 alert alert-success no-border-radius text-center">
                    {{ message }}
                </div>
                {% elif message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}
                  <div class="col-sm-12 alert alert-danger no-border-radius text-center">
                      {{ message }}
                  </div>
                {% endif %}
              {% endfor %}
            {% endif %}

              {% if wizard.steps.current == 'token' %}
                  <div class="col-sm-12 alert alert-info no-border-radius text-center">
                      {% blocktrans %}Please enter the token generated by your token generator.{% endblocktrans %}
                  </div>
              {% endif %}

            {% if form.non_field_errors %}
              {% trans "Please enter a correct username and password." as original_error_msg %}

              {% for err in form.non_field_errors %}
                  <div class="col-sm-12 alert alert-danger no-border-radius text-center" role="alert">
                      {{ err }}
                  </div>
                  {% if err == original_error_msg %}
                      <div class="col-sm-12 alert alert-warning no-border-radius text-center" role="alert">
                          {% url 'login_assistance' as assistance_url %}
                          {% blocktrans trimmed %}
                              <p>After 5 incorrect login attempts, you must reset your password in order to log in.</p>
                              <p><a class="alert-link" href="{{ assistance_url }}">Click here to reset your password.</a></p>
                          {% endblocktrans %}
                      </div>
                  {% endif %}
                {% endfor %}
            {% endif %}
          </div>

          {% if wizard.steps.current == 'auth' %}
            <input type="hidden" name="login_view-current_step" value="auth" id="id_login_view-current_step">

            <div class="mb-3">
              <label for="id_auth-username">{{ form.username.label }}:</label>
              <input type="text" name="auth-username" class="form-control" autofocus="autofocus" value="{{ form.username.value|default:"" }}"maxlength="254" required="required" id="id_auth-username">
            </div>
            <div class="mb-3">
              <label for="id_auth-password">{{ form.password.label }}:</label>
              <input type="password" name="auth-password" class="form-control" value="{{ form.password.value|default:"" }}" required="required" id="id_auth-password">
            </div>
              <div class="mb-3 form-check">
                  <input type="checkbox" id="id_toggle-password" class="form-check-input">
                  <label class="form-check-label" for="id_toggle-password">{% trans "Show Password" %}</label>
              </div>
          {% elif wizard.steps.current == 'token' %}
            <input type="hidden" name="login_view-current_step" value="token" id="id_login_view-current_step">
            <div class="mb-3">
              <label for="id_token-otp_token">Token:</label>
              <input type="number" name="token-otp_token" class="form-control" autofocus="autofocus" value="{{ form.otp_token.value|default:"" }}" min="1" max="99999999" id="id_token-otp_token">
            </div>
          {% else %}
            {% include "two_factor/_wizard_forms.html" %}
          {% endif %}

          {# hidden submit button to enable [enter] key #}
          <div style="display: none"><input type="submit" value=""/></div>

          <div class="row">
            <div class="col-sm-12">
              {% include "two_factor/_wizard_actions.html" %}
            </div>
          </div>
      </div>

      {% block login_footer %}
      <div class="card-footer">
          <a href="{% url 'login_assistance' %}">{% trans "Trouble signing in?" %}</a>
          <div class="clearfix"></div>
      </div>
      {% endblock %}
    </div>
  </form>

{% endblock %}
